<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MBASCAPE — Password Required</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>MBASCAPE — ESCAPE FROM ANALYTIX</h1>
        <div class="small">Team-based campus escape — collect clues, form the phrase, unlock the WAY OUT LOCK</div>
      </div>
    </header>

    <section class="panel">
      <!-- Team Display Section -->
      <div style="margin-bottom: 20px;">
        <strong>Confirm Your Team</strong>
        <div id="teamDisplay" style="display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; justify-content: center;">
          <!-- Player pills will be inserted here by JS -->
        </div>
      </div>
      <hr style="border-color: rgba(255,255,255,0.06); margin-bottom: 20px; border-style: solid; border-width: 1px 0 0 0;">
      
      <!-- Password Section -->
      <div style="margin-bottom:12px">
        <strong>Password Required</strong>
        <p class="small" style="margin-top: 4px;">Please enter the game password to continue.</p>
        <div class="row" style="margin-top:20px; flex-direction: column;">
          <div id="passwordContainer" class="password-container">
            <!-- JS will generate inputs here -->
          </div>
          <button class="btn" id="submitPassword" style="margin-top: 20px; width: 150px;">Enter</button>
        </div>
        <p id="errorMessage" class="small" style="color:#ff9aa2; margin-top:12px; height: 1em; text-align: center;"></p>
      </div>
    </section>
  </div>

<script>
  // --- IMPORTANT: Change the password here ---
  const CORRECT_PASSWORD = "ESCAPE2025"; 

  const passwordContainer = document.getElementById('passwordContainer');
  const submitBtn = document.getElementById('submitPassword');
  const errorMessage = document.getElementById('errorMessage');
  const teamDisplay = document.getElementById('teamDisplay');
  const inputs = [];

  // --- Display Team Info ---
  const playersData = localStorage.getItem('mbascape_players');
  if (!playersData) {
    // If no team data exists, redirect back to the start page
    window.location.href = 'index.html';
  } else {
    const players = JSON.parse(playersData);
    if (players && players.length > 0) {
        players.forEach(player => {
            const pill = document.createElement('div');
            pill.className = 'player-pill'; // Reusing existing style
            pill.textContent = player.name;
            teamDisplay.appendChild(pill);
        });
    }
  }

  // --- Create Password Input Boxes ---
  for (let i = 0; i < CORRECT_PASSWORD.length; i++) {
    const input = document.createElement('input');
    input.type = 'password';
    input.maxLength = 1;
    passwordContainer.appendChild(input);
    inputs.push(input);

    // Event listener for auto-focusing next input
    input.addEventListener('input', () => {
      if (input.value && i < inputs.length - 1) {
        inputs[i + 1].focus();
      }
    });

    // Event listener for backspace
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace' && !input.value && i > 0) {
        inputs[i - 1].focus();
      }
    });
  }

  // Event listener for pasting
  if (inputs.length > 0) {
    inputs[0].addEventListener('paste', (e) => {
      e.preventDefault();
      const pastedData = e.clipboardData.getData('text');
      for (let i = 0; i < pastedData.length && i < inputs.length; i++) {
        inputs[i].value = pastedData[i];
      }
      // Focus the next empty box after paste
      const nextEmpty = inputs.find(inp => !inp.value);
      if(nextEmpty) {
        nextEmpty.focus();
      } else {
        inputs[inputs.length - 1].focus();
      }
    });
  }

  // --- Password Check Logic ---
  function checkPassword() {
    const enteredPassword = inputs.map(input => input.value).join('');
    if (enteredPassword === CORRECT_PASSWORD) {
      errorMessage.textContent = "";
      // --- THIS LINE IS CHANGED ---
      window.location.href = 'rules.html';
    } else {
      errorMessage.textContent = "Incorrect password. Please try again.";
      inputs.forEach(input => input.value = '');
      inputs[0].focus();
    }
  }

  submitBtn.addEventListener('click', checkPassword);
  
  // Also allow pressing enter from any input box
  inputs.forEach(input => {
    input.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
          checkPassword();
        }
    });
  });

</script>
</body>
</html>
