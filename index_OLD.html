<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBASCAPE: An Escape Room Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #1f2937, #111827);
        }

        .pulse-timer {
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
    </style>
</head>
<body class="gradient-bg text-gray-100 flex items-center justify-center min-h-screen p-4">

    <div id="game-container" class="w-full max-w-4xl bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-10 flex flex-col items-center space-y-8">
        <!-- Main game content will be rendered here by JavaScript -->
    </div>

    <script>
        // Game variables
        const gameContainer = document.getElementById('game-container');
        let gameState = {
            currentView: 'start',
            timer: 300, // 5 minutes in seconds
            timerInterval: null,
            clues: {
                puzzle1: null,
                puzzle2: null,
                puzzle3: null,
                puzzle4: null
            },
            regions: {
                adminBlock: { name: 'Admin Block', solved: false, clue: '15' },
                auditorium: { name: 'Auditorium', solved: false, clue: 'IMT' },
                academicBlock: { name: 'Academic Block', solved: false, clue: '74' },
                hostel: { name: 'Hostel Block', solved: false, clue: 'LOCK' }
            }
        };

        // UI Rendering Functions
        const renderHeader = () => {
            const header = document.createElement('div');
            header.className = 'w-full flex justify-between items-center mb-6 md:mb-8';
            header.innerHTML = `
                <h1 class="text-3xl md:text-4xl font-bold text-teal-400">MBASCAPE</h1>
                <div id="timer" class="text-2xl md:text-3xl font-bold text-amber-300">05:00</div>
            `;
            gameContainer.appendChild(header);
        };

        const renderMessage = (title, message) => {
            const messageEl = document.createElement('div');
            messageEl.className = 'text-center mb-8';
            messageEl.innerHTML = `
                <h2 class="text-3xl font-bold mb-2 text-white">${title}</h2>
                <p class="text-gray-300 max-w-2xl mx-auto">${message}</p>
            `;
            gameContainer.appendChild(messageEl);
        };

        const createButton = (text, onClick, className = '') => {
            const button = document.createElement('button');
            button.innerText = text;
            button.className = `px-6 py-3 rounded-full font-bold transition-all duration-300 transform hover:scale-105 shadow-lg ${className}`;
            button.onclick = onClick;
            return button;
        };

        const updateTimerDisplay = () => {
            const timerEl = document.getElementById('timer');
            if (!timerEl) return;
            const minutes = Math.floor(gameState.timer / 60);
            const seconds = gameState.timer % 60;
            timerEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            if (gameState.timer <= 30) {
                timerEl.classList.add('text-red-400', 'pulse-timer');
            }
        };

        const startGameTimer = () => {
            gameState.timerInterval = setInterval(() => {
                if (gameState.timer > 0) {
                    gameState.timer--;
                    updateTimerDisplay();
                } else {
                    clearInterval(gameState.timerInterval);
                    endGame(false);
                }
            }, 1000);
        };

        // Game State and Logic
        const renderStartScreen = () => {
            gameContainer.innerHTML = '';
            renderMessage('MBASCAPE: The IMT Nagpur Challenge', "Welcome, team! You've been locked in the IMT Nagpur campus. To escape, you must solve puzzles in different regions to collect clues for the \"WAY OUT LOCK\". You have 5 minutes to escape. Good luck!");
            const startBtn = createButton('Start Game', () => {
                startGameTimer();
                renderView('map');
            }, 'bg-teal-500 text-gray-900 hover:bg-teal-400');
            gameContainer.appendChild(startBtn);
        };

        const renderMap = () => {
            gameContainer.innerHTML = '';
            renderHeader();
            renderMessage('Campus Map', 'Navigate to the different blocks to find the puzzles. Solve them to collect the clues you need to escape!');

            const mapGrid = document.createElement('div');
            mapGrid.className = 'grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-8 w-full';
            Object.keys(gameState.regions).forEach(key => {
                const region = gameState.regions[key];
                const isSolved = region.solved;
                const regionBtn = createButton(
                    region.name,
                    () => isSolved ? null : renderView(key),
                    `p-4 rounded-xl text-center font-semibold transition-all duration-300 ${isSolved ? 'bg-gray-600 text-gray-400 cursor-not-allowed' : 'bg-gray-700 hover:bg-gray-600 text-white'}`
                );
                mapGrid.appendChild(regionBtn);
            });
            gameContainer.appendChild(mapGrid);

            const cluesContainer = document.createElement('div');
            cluesContainer.className = 'w-full text-center mt-8';
            cluesContainer.innerHTML = `<h3 class="text-2xl font-bold mb-4">Clue Board</h3>`;
            const cluesDisplay = document.createElement('div');
            cluesDisplay.className = 'flex justify-center flex-wrap gap-4 text-xl font-mono';
            Object.values(gameState.clues).forEach(clue => {
                const clueItem = document.createElement('div');
                clueItem.className = 'bg-gray-700 px-4 py-2 rounded-lg';
                clueItem.innerText = clue || 'ðŸ”’';
                cluesDisplay.appendChild(clueItem);
            });
            cluesContainer.appendChild(cluesDisplay);
            gameContainer.appendChild(cluesContainer);
            
            const solvedCount = Object.values(gameState.regions).filter(r => r.solved).length;
            if (solvedCount === 4) {
                const finalDoorBtn = createButton('Go to The WAY OUT LOCK', () => renderView('finalDoor'), 'bg-amber-500 text-gray-900 hover:bg-amber-400 mt-8');
                gameContainer.appendChild(finalDoorBtn);
            }
        };

        const renderPuzzle1 = () => { // Admin Block: Simon Says
            gameContainer.innerHTML = '';
            renderHeader();
            renderMessage('Admin Block Puzzle', 'A security panel is flashing a sequence of lights. Repeat the pattern to unlock the clue.');
            
            const sequence = ['red', 'blue', 'green', 'yellow'];
            let playerSequence = [];
            let currentStep = 0;
            let canClick = false;

            const puzzleArea = document.createElement('div');
            puzzleArea.className = 'flex flex-col items-center space-y-6';

            const lightGrid = document.createElement('div');
            lightGrid.className = 'grid grid-cols-2 gap-4';
            const colors = ['red', 'blue', 'green', 'yellow'];
            const colorMap = {
                red: 'bg-red-500',
                blue: 'bg-blue-500',
                green: 'bg-green-500',
                yellow: 'bg-yellow-500'
            };

            colors.forEach(color => {
                const light = document.createElement('div');
                light.id = `light-${color}`;
                light.className = `w-24 h-24 rounded-full transition-all duration-300 ${colorMap[color]} cursor-pointer opacity-50 hover:opacity-100`;
                light.addEventListener('click', () => {
                    if (canClick) {
                        playerSequence.push(color);
                        if (playerSequence[currentStep] === sequence[currentStep]) {
                            currentStep++;
                            if (currentStep === sequence.length) {
                                renderPuzzleResult(true, '15');
                            }
                        } else {
                            renderPuzzleResult(false);
                        }
                    }
                });
                lightGrid.appendChild(light);
            });
            puzzleArea.appendChild(lightGrid);

            const messageEl = document.createElement('p');
            messageEl.className = 'text-center text-lg';
            puzzleArea.appendChild(messageEl);

            const playSequence = () => {
                canClick = false;
                playerSequence = [];
                currentStep = 0;
                messageEl.textContent = 'Watch the sequence...';
                let i = 0;
                const interval = setInterval(() => {
                    if (i < sequence.length) {
                        const light = document.getElementById(`light-${sequence[i]}`);
                        light.style.opacity = '1';
                        setTimeout(() => light.style.opacity = '0.5', 500);
                        i++;
                    } else {
                        clearInterval(interval);
                        messageEl.textContent = 'Now you try!';
                        canClick = true;
                    }
                }, 1000);
            };

            gameContainer.appendChild(puzzleArea);
            playSequence();
        };

        const renderPuzzle2 = () => { // Auditorium: Riddle
            gameContainer.innerHTML = '';
            renderHeader();
            renderMessage('Auditorium Puzzle', 'A locked box is here. The only clue is this riddle. Solve it to get your clue.');

            const puzzleArea = document.createElement('div');
            puzzleArea.className = 'flex flex-col items-center space-y-6';

            const riddleText = document.createElement('p');
            riddleText.className = 'text-xl md:text-2xl italic font-serif text-center mb-6 max-w-xl';
            riddleText.innerHTML = `I am a place of speeches and music, but I have no voice. I hold hundreds, but cannot lift a single one. What am I?`;
            puzzleArea.appendChild(riddleText);

            const inputEl = document.createElement('input');
            inputEl.type = 'text';
            inputEl.placeholder = 'Your answer here...';
            inputEl.className = 'w-full max-w-md px-4 py-2 rounded-lg bg-gray-700 text-gray-100 border-2 border-transparent focus:border-teal-500 focus:outline-none';
            puzzleArea.appendChild(inputEl);

            const submitBtn = createButton('Submit Answer', () => {
                const answer = inputEl.value.trim().toLowerCase();
                if (answer === 'auditorium') {
                    renderPuzzleResult(true, 'IMT');
                } else {
                    renderPuzzleResult(false);
                }
            }, 'bg-teal-500 text-gray-900 hover:bg-teal-400');
            puzzleArea.appendChild(submitBtn);

            gameContainer.appendChild(puzzleArea);
        };

        const renderPuzzle3 = () => { // Academic Block: Math Puzzle
            gameContainer.innerHTML = '';
            renderHeader();
            renderMessage('Academic Block Puzzle', 'A projector screen shows this math problem. The solution is your next clue.');
            
            const puzzleArea = document.createElement('div');
            puzzleArea.className = 'flex flex-col items-center space-y-6';

            const problemText = document.createElement('p');
            problemText.className = 'text-4xl md:text-5xl font-mono text-center mb-6';
            problemText.innerHTML = `(2 x 5) + (8 x 8) = ?`;
            puzzleArea.appendChild(problemText);

            const inputEl = document.createElement('input');
            inputEl.type = 'number';
            inputEl.placeholder = 'Your answer here...';
            inputEl.className = 'w-full max-w-md px-4 py-2 rounded-lg bg-gray-700 text-gray-100 border-2 border-transparent focus:border-teal-500 focus:outline-none';
            puzzleArea.appendChild(inputEl);

            const submitBtn = createButton('Submit Answer', () => {
                const answer = parseInt(inputEl.value, 10);
                if (answer === 74) {
                    renderPuzzleResult(true, '74');
                } else {
                    renderPuzzleResult(false);
                }
            }, 'bg-teal-500 text-gray-900 hover:bg-teal-400');
            puzzleArea.appendChild(submitBtn);

            gameContainer.appendChild(puzzleArea);
        };

        const renderPuzzle4 = () => { // Hostel Block: Anagram
            gameContainer.innerHTML = '';
            renderHeader();
            renderMessage('Hostel Block Puzzle', 'A graffiti on the wall has these scrambled letters. Unscramble them to get your final clue.');
            
            const puzzleArea = document.createElement('div');
            puzzleArea.className = 'flex flex-col items-center space-y-6';

            const scrambledWord = document.createElement('div');
            scrambledWord.className = 'text-5xl font-bold tracking-widest text-amber-300';
            scrambledWord.innerText = 'OLKC';
            puzzleArea.appendChild(scrambledWord);

            const inputEl = document.createElement('input');
            inputEl.type = 'text';
            inputEl.placeholder = 'Unscramble the word...';
            inputEl.className = 'w-full max-w-md px-4 py-2 mt-4 rounded-lg bg-gray-700 text-gray-100 border-2 border-transparent focus:border-teal-500 focus:outline-none';
            puzzleArea.appendChild(inputEl);

            const submitBtn = createButton('Submit Answer', () => {
                const answer = inputEl.value.trim().toUpperCase();
                if (answer === 'LOCK') {
                    renderPuzzleResult(true, 'LOCK');
                } else {
                    renderPuzzleResult(false);
                }
            }, 'bg-teal-500 text-gray-900 hover:bg-teal-400');
            puzzleArea.appendChild(submitBtn);

            gameContainer.appendChild(puzzleArea);
        };

        const renderPuzzleResult = (success, clue = null) => {
            if (success) {
                // Determine which puzzle was just solved
                const puzzleName = gameState.currentView;
                const regionKey = Object.keys(gameState.regions).find(key => key === puzzleName);
                if (regionKey) {
                    gameState.regions[regionKey].solved = true;
                    gameState.clues[puzzleName] = clue;
                }
                
                gameContainer.innerHTML = '';
                renderHeader();
                renderMessage('Success!', `You've solved the puzzle! Your new clue is: <span class="text-amber-300 font-bold">${clue}</span>`);
                const backBtn = createButton('Back to Map', () => renderView('map'), 'bg-gray-500 text-white hover:bg-gray-400 mt-8');
                gameContainer.appendChild(backBtn);
            } else {
                const currentViewName = gameState.currentView;
                gameContainer.innerHTML = '';
                renderHeader();
                renderMessage('Incorrect!', "That's not the right answer. Try again.");
                const backBtn = createButton('Try Again', () => renderView(currentViewName), 'bg-red-500 text-white hover:bg-red-400 mt-8');
                gameContainer.appendChild(backBtn);
            }
        };

        const renderFinalDoor = () => {
            gameContainer.innerHTML = '';
            renderHeader();
            renderMessage('The WAY OUT LOCK', 'Arrange your clues in a meaningful manner and enter the full sequence below to escape.');
            
            const cluesContainer = document.createElement('div');
            cluesContainer.className = 'w-full text-center mt-4 mb-8';
            cluesContainer.innerHTML = `<h3 class="text-2xl font-bold mb-4">Your Clues:</h3>`;
            const cluesDisplay = document.createElement('div');
            cluesDisplay.className = 'flex justify-center flex-wrap gap-4 text-xl font-mono';
            Object.values(gameState.clues).forEach(clue => {
                const clueItem = document.createElement('div');
                clueItem.className = 'bg-gray-700 px-4 py-2 rounded-lg';
                clueItem.innerText = clue || 'ðŸ”’';
                cluesDisplay.appendChild(clueItem);
            });
            cluesContainer.appendChild(cluesDisplay);
            gameContainer.appendChild(cluesContainer);

            const inputEl = document.createElement('input');
            inputEl.type = 'text';
            inputEl.placeholder = 'Enter the final code here...';
            inputEl.className = 'w-full max-w-md px-4 py-2 rounded-lg bg-gray-700 text-gray-100 border-2 border-transparent focus:border-teal-500 focus:outline-none';
            gameContainer.appendChild(inputEl);

            const submitBtn = createButton('Unlock Door', () => {
                const answer = inputEl.value.trim().toUpperCase();
                const correctCode = 'IMT-1574-LOCK';
                if (answer === correctCode) {
                    endGame(true);
                } else {
                    renderMessage('The WAY OUT LOCK', 'That is not the correct code. Try again!');
                }
            }, 'bg-teal-500 text-gray-900 hover:bg-teal-400 mt-8');
            gameContainer.appendChild(submitBtn);

            const backBtn = createButton('Back to Map', () => renderView('map'), 'bg-gray-500 text-white hover:bg-gray-400 mt-4');
            gameContainer.appendChild(backBtn);
        };

        const endGame = (didWin) => {
            clearInterval(gameState.timerInterval);
            gameContainer.innerHTML = '';
            renderHeader();
            if (didWin) {
                renderMessage('Congratulations!', 'You have successfully arranged the clues and escaped IMT Nagpur!');
                const playAgainBtn = createButton('Play Again', () => location.reload(), 'bg-teal-500 text-gray-900 hover:bg-teal-400 mt-8');
                gameContainer.appendChild(playAgainBtn);
            } else {
                renderMessage('Time\'s Up!', 'You ran out of time. The campus is now on lockdown. Better luck next time!');
                const playAgainBtn = createButton('Play Again', () => location.reload(), 'bg-red-500 text-white hover:bg-red-400 mt-8');
                gameContainer.appendChild(playAgainBtn);
            }
        };

        const renderView = (viewName) => {
            gameState.currentView = viewName;
            switch (viewName) {
                case 'start':
                    renderStartScreen();
                    break;
                case 'map':
                    renderMap();
                    break;
                case 'adminBlock':
                    renderPuzzle1();
                    break;
                case 'auditorium':
                    renderPuzzle2();
                    break;
                case 'academicBlock':
                    renderPuzzle3();
                    break;
                case 'hostel':
                    renderPuzzle4();
                    break;
                case 'finalDoor':
                    renderFinalDoor();
                    break;
                default:
                    renderStartScreen();
            }
        };

        // Initial game start
        renderView('start');
    </script>
</body>
</html>
